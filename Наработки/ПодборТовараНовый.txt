//////////////////////////////////////////////////////////////////////////////Кнопка для удобства - неиспользуеться
&НаКлиенте
Процедура ПолучитьТЧ(Команда)
	ПолучитьНуменклатуруИзТЧ();
КонецПроцедуры
//////////////////////////////////////////////////////////////////////////////Кнопка для удобства - неиспользуеться
********************************************************************************************************************************************
Код ниже выполняеться из процедуры "ИерархияНоменклатурыПриАктивизацииСтроки"

********************************************************************************************************************************************
&НаКлиенте
Процедура ПолучитьТЧ(Команда)
	ПолучитьНуменклатуруИзТЧ();
КонецПроцедуры


&НаКлиенте
Функция ПолучитьНуменклатуруИзТЧ()//0
	НаСервереПр();
КонецФункции
//_ниже Получение строк из Динамического списка в Таблицу значений
&НаСервере
Функция НаСервереПр()//1
	СписокСхема = Элементы.ПодборТаблицаНоменклатура.ПолучитьИсполняемуюСхемуКомпоновкиДанных();
	Настройки = Элементы.ПодборТаблицаНоменклатура.ПолучитьИсполняемыеНастройкиКомпоновкиДанных();
	
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СписокСхема, Настройки,,,Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));
	
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновки.Инициализировать(МакетКомпоновки);
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений;
	
	ПолученнаяТЗ = ПроцессорВывода.Вывести(ПроцессорКомпоновки);
	ФункцияПроходаМассивом(ПолученнаяТЗ);
Конецфункции
//_ниже Проход таблицы значений для запроса остатков на складах\магазинах
&НаСервере
Функция ФункцияПроходаМассивом(параметр)//2
	_вТЗ = Новый ТаблицаЗначений;
	_вТЗ.Колонки.Добавить("Наименование");
	_вТЗ.Колонки.Добавить("Цена");
	_вТЗ.Колонки.Добавить("Белореченск");
	_вТЗ.Колонки.Добавить("Склад");
	_вТЗ.Колонки.Добавить("Сочи");
	Для Каждого _стр ИЗ параметр Цикл
		_номе = _стр.Номенклатура;
		_цена = _стр.Цена;
		_вернувшаясяТЗ = ЗапросКТаблице(_стр.Номенклатура);
		
		//ВернувшиесяДанныеНужноЗасунутьВОднуСтроку(Наименование\Цена\Склад0\Склад1\Склад2)-ДалееДобавитьЕеВПодборТовараНоменклатураНовый
		Для Каждого _стрВ ИЗ _вернувшаясяТЗ Цикл//4
						
			_имяКолонки = Строка(_стрВ.СкладМагазин);
			Если _имяКолонки = "Центр звука (Сочи)" Тогда
				_остСочи = _стрВ.КоличествоОстаток;
			ИначеЕсли _имяКолонки = "Склад" Тогда
				_остСклад = _стрВ.КоличествоОстаток;
			ИначеЕсли _имяКолонки = "Центр звука (Белореченск)" Тогда
				_остБелореченск = _стрВ.КоличествоОстаток;
			Иначе
				Продолжить;
			КонецЕсли;
		КонецЦикла;
		_вСт = _вТЗ.Добавить();
		_вСт.Белореченск = _остБелореченск;
		_вСт.Склад = _остСклад;
		_вСт.Сочи = _остСочи;
		_вСт.Наименование = _номе;
		_вСт.Цена = _цена;
	КонецЦикла;
	//Полученную таблицу значений можно выгрузить в новую твбличную часть подбора товаров
	_вТЗ = _вТЗ;
	ЗаполнитьПодборТовараНоменклатураНовый(_вТЗ);
КонецФункции
//_ниже Запрос остатков на складах\магазинах
&НаСервере
Функция ЗапросКТаблице(_ссыль)//3
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", _ссыль);
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТоварыНаСкладахОстатки.Склад КАК Склад,
		|	ТоварыНаСкладахОстатки.Номенклатура КАК Номенклатура,
		|	ТоварыНаСкладахОстатки.КоличествоОстаток КАК КоличествоОстаток,
		|	ПродажиОбороты.КоличествоОборот КАК КоличествоОборот,
		|	ТоварыНаСкладахОстатки.Склад.Магазин КАК СкладМагазин
		|ИЗ
		|	РегистрНакопления.ТоварыНаСкладах.Остатки() КАК ТоварыНаСкладахОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты() КАК ПродажиОбороты
		|		ПО (ТоварыНаСкладахОстатки.Номенклатура = ПродажиОбороты.Номенклатура)
		|ГДЕ
		|	ПродажиОбороты.Номенклатура.Ссылка = &Ссылка";
	Выборка = Запрос.Выполнить().Выгрузить();
	_вТабЗнач = Новый ТаблицаЗначений;
	_вТабЗнач.Колонки.Добавить("Номенклатура");
	_вТабЗнач.Колонки.Добавить("КоличествоОстаток");
	_вТабЗнач.Колонки.Добавить("СкладМагазин");
	
	Для Каждого _строка ИЗ Выборка Цикл
		_вСтр = _вТабЗнач.Добавить();
		_вСтр.Номенклатура = _строка.Номенклатура;
		_вСтр.КоличествоОстаток = _строка.КоличествоОстаток;
		_вСтр.СкладМагазин = _строка.СкладМагазин;
	КонецЦикла;
	
	Возврат _вТабЗнач;//ДолженВернутьМассивДляОбьеденения
КонецФункции
//_ниже Для более удобного контроля вывода данных в табличную часть
&НаСервере
Функция ЗаполнитьПодборТовараНоменклатураНовый(_таблицаЗначений)//4
	Для Каждого _строка ИЗ _таблицаЗначений Цикл
		НС = ПодборТовараНоменклатураНовый.Добавить();
		НС.Наименование = _строка.Наименование;
		НС.Цена = _строка.Цена;
		НС.Склад0 = _строка.Белореченск;
		НС.Склад1 = _строка.Склад;
		НС.Склад2 = _строка.Сочи;
	КонецЦикла;
КонецФункции
********************************************************************************************************************************************